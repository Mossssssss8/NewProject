<!DOCTYPE html>
<!-- Created by CodingLab |www.youtube.com/c/CodingLabYT-->
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <title> Human Pose Estimation Technology </title>
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/64d58efce2.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Boxicons CDN Link -->
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@2.2.1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.0/chart.min.js"></script>
    <script src="ScoreApi.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body onload="initInDashBoard()">
    <div class="sidebar">
        <div class="logo-details">
            <i class='#'></i>
            <div class="logo_name">Estimation Technology</div>
            <i class='bx bx-menu' id="btn"></i>
        </div>
        <ul class="nav-list" style="margin-left: -30px;">
            <li>
                <i class='bx bx-search'></i>
                <input type="text" placeholder="Search...">
                <span class="tooltip">Search</span>
            </li>
            <li>
                <a href="index.html">
                    <i class='bx bx-grid-alt'></i>
                    <span class="links_name">Dashboard</span>
                </a>
                <span class="tooltip">Dashboard</span>
            </li>
            <li>
                <a href="Set-mode.html">
                    <i class='bx bx-transfer alt'></i>
                    <span class="links_name">Set mode</span>
                </a>
                <span class="tooltip">Exercise</span>
            </li>
            <li>
                <a href="HIITmode.html">
                    <i class='bx bx-task'></i>
                    <span class="links_name">HIIT Mode</span>
                </a>
                <span class="tooltip">HIIT Workout</span>
            </li>
            <li>
                <a href="Endurance Mode.html">
                    <i class='bx bx-task'></i>
                    <span class="links_name">Endurance Mode</span>
                </a>
                <span class="tooltip">Endurance Mode</span>
            </li>
            <li>
                <a href="Video.html">
                    <i class='bx bx-video'></i>
                    <span class="links_name">Video</span>
                </a>
                <span class="tooltip">Video</span>
            </li>
            <li>
                <a href="Video-Stretching.html">
                    <i class='bx bx-video'></i>
                    <span class="links_name">Video-Stretching</span>
                </a>
                <span class="tooltip">Video-Stretching</span>
            </li>
            <li>
                <a href="History.html">
                    <i class='bx bx-pie-chart-alt-2'></i>
                    <span class="links_name">History</span>
                </a>
                <span class="tooltip">History</span>
            </li>
            <li>
                <a href="setting.html">
                    <i class='bx bx-cog'></i>
                    <span class="links_name">Setting</span>
                </a>
                <span class="tooltip">Setting</span>
            </li>
            <li class="profile">
                <div class="profile-details">
                    <!-- <img src="profile.jpg" alt="profileImg"> -->
                    <div class="name_job">
                        <div id="ShowUserName" class="name">User</div>
                        <div class="job">Human Pose Estimation</div>
                    </div>
                </div>
                <button style="display: contents;"><i class='bx bx-log-out' title="Log out!" onclick="logout()"
                        id="log_out"></i></button>
            </li>
        </ul>
    </div>
    <section class="home-section">
        <!-- <div class="text">Dashboard</div><br> -->
        <section class="first-section">
            <div class="head_content_index">
                <div class="overlay">
                    <div class="text">
                        <span>D</span>
                        <span>A</span>
                        <span>S</span>
                        <span>H</span>
                        <span>B</span>
                        <span>O</span>
                        <span>A</span>
                        <span>R</span>
                        <span>D</span>
                    </div>
                </div>
            </div>
            <!-- <a href="#scrollto"><img src="../หน้าต่าง Login/img/ex2.jpg"></a></div> -->
        </section>
        <section>
            <div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Sales chart -->
                <!-- ============================================================== -->
                <div class="row" >
                    <div style="display: flex; justify-content: center;">
                        <div class="col-lg-6" style="margin-top: 20px; background: rgba(255, 255, 255, 0.5);"
                            id="chart">
                        </div>
                    </div>
                    <div class="ms-auto setchangedate">
                        <div class="dl">
                            <select class="form-select shadow-none" onchange="changeDay()" id="changeDay">
                                <option value="0" selected>Today</option>
                                <option value="1">Weekly</option>
                                <option value="2">Monthly</option>
                            </select>
                        </div>
                    </div>
                    <!-- --------------------------------------------------------------------------------------------------------------------- -->

                    <!-- ----------------------------------------------------------------------------------------------------------------------------------------------------------- -->
                    <div class="row">
                        <!-- column -->
                        <div class="col-12">
                            <div class="card"
                                style="margin-top: 5px ; margin-left: 1px; margin-right: -25px; background: rgba(255, 255, 255, 0.5);">
                                <div class="card-body">
                                    <!-- title -->
                                    <div class="d-md-flex">
                                        <div>
                                            <h4 style="text-transform:uppercase" class="card-title">HIIT Mode Traing
                                            </h4>
                                        </div>

                                    </div>
                                    <!-- title -->
                                    <div class="table-responsive">
                                        <table class="table mb-0 table-hover align-middle text-nowrap">
                                            <thead>
                                                <tr class="textDashboard">
                                                    <th style="font-size: 110% " class="border-top-0">Exercise - Type
                                                    </th>
                                                    <th style="font-size: 110% " class="border-top-0">Date</th>
                                                    <th style="font-size: 110% " class="border-top-0">Duration</th>
                                                    <th style="font-size: 110% " class="border-top-0">Status - Exercise
                                                    </th>
                                                    <th style="font-size: 110% " class="border-top-0">Calories</th>
                                                </tr>
                                            </thead>
                                            <tbody id="HiiT">

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Endurance -->
                    <div class="col-12">
                        <div class="card"
                            style="margin-top: 10px ; margin-left: 1px; background: rgba(255, 255, 255, 0.5);">
                            <div class="card-body">
                                <!-- title -->
                                <div class="d-md-flex">
                                    <div>
                                        <h4 style="text-transform:uppercase" class="card-title">Endurance Mode Training
                                        </h4>
                                    </div>
                                    <div class="ms-auto">
                                        <div class="dl">

                                        </div>
                                    </div>
                                </div>
                                <!-- title -->
                                <div class="table-responsive">
                                    <table class="table mb-0 table-hover align-middle text-nowrap">
                                        <thead>
                                            <tr class="textDashboard">
                                                <th style="font-size: 110% " class="border-top-0">Exercise - Type</th>
                                                <th style="font-size: 110% " class="border-top-0">Date</th>
                                                <th style="font-size: 110% " class="border-top-0">Duration</th>
                                                <th style="font-size: 110% " class="border-top-0">Status - Exercise</th>
                                                <th style="font-size: 110% " class="border-top-0">Calories</th>
                                            </tr>
                                        </thead>
                                        <tbody id="Endurance">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

        </section>
        <script src="script.js"></script>
        <script>
            var isRederchart = false
            var options
            async function Getallscore(Allscore) {
                options = {
                    chart: {
                        height: 350,
                        type: "line",
                        stacked: false
                    },
                    dataLabels: {
                        enabled: false
                    },
                    colors: ['#99C2A2', '#C5EDAC', '#66C7F4'],
                    series: [

                        {
                            name: 'Repetitions',
                            type: 'column',
                            data: []
                        },
                        {
                            name: "Duration(Minute)",
                            type: 'column',
                            data: []
                        },

                    ],
                    stroke: {
                        width: [4, 4, 4]
                    },
                    plotOptions: {
                        bar: {
                            columnWidth: "20%"
                        }
                    },
                    xaxis: {
                        categories: ["Pull-UP", "Push-UP", "Squat", "Diamond Push-UP", "Leg raise"]
                    },
                    yaxis: [
                        {
                            seriesName: 'Repetitions',
                            axisTicks: {
                                show: false
                            },
                            axisBorder: {
                                show: false,
                            },
                            title: {
                                text: "Repetitions"
                            }
                        },
                        {
                            seriesName: 'Repetitions',
                            show: false
                        }, {
                            opposite: true,
                            seriesName: 'Line C',
                            axisTicks: {
                                show: false
                            },
                            axisBorder: {
                                show: false,
                            },
                            title: {
                                text: "Duration(Min)"
                            }
                        }
                    ],
                    tooltip: {
                        shared: true,
                        intersect: false,
                        x: {
                            show: false
                        }
                    },
                    legend: {
                        horizontalAlign: "left",
                        offsetX: 40
                    }
                };


                var myscore = []
                var mytime = []

                var TimeSquats = 0
                var TimePullup = 0
                var TimePushup = 0
                var TimeLegraise = 0
                var TimeDMPushup = 0

                var scoreSquats = 0
                var scorePullup = 0
                var scorePushup = 0
                var scoreLegRaise = 0
                var scoreDMPushup = 0

                var AllHIIT
                var User = GetUser()
                // Allscore = await getScoreById(User._id)

                Timesquats = CountTimeByNameEx(Allscore, "Squats")
                TimePullup = CountTimeByNameEx(Allscore, "Pull-Up")
                TimePushup = CountTimeByNameEx(Allscore, "Push-up")
                TimeLegraise = CountTimeByNameEx(Allscore, "LegRaise")
                TimeDMPushup = CountTimeByNameEx(Allscore, "DMPushup")

                scoreSquats = CountScoreByNameEx(Allscore, "Squats")
                scorePullup = CountScoreByNameEx(Allscore, "Pull-Up")
                scorePushup = CountScoreByNameEx(Allscore, "Push-up")
                scoreLegRaise = CountScoreByNameEx(Allscore, "LegRaise")
                scoreDMPushup = CountScoreByNameEx(Allscore, "DMPushup")

                myscore.push(scorePullup)
                myscore.push(scorePushup)
                myscore.push(scoreSquats)
                myscore.push(scoreDMPushup)
                myscore.push(scoreLegRaise)

                options.series[0].data = myscore





                mytime.push(SecToMin(TimePullup))
                mytime.push(SecToMin(TimePushup))
                mytime.push(SecToMin(Timesquats))
                mytime.push(SecToMin(TimeDMPushup))
                mytime.push(SecToMin(TimeLegraise))


                options.series[1].data = mytime
                var chart = new ApexCharts(document.querySelector("#chart"), options);
                if (isRederchart) {
                    document.querySelector("#chart").innerHTML = "";
                    // document.querySelector("#chart1").innerHTML = "";
                } else {
                    isRederchart = true;
                }
                chart.render();
            }
            function SecToMin(Seconds) {
                var minute = parseInt(Seconds / 60)
                return `${minute}.${Seconds % 60}`
            }
            function Getallscore1() {
                var options1 = {
                    chart: {
                        height: 280,
                        type: "radialBar",
                    },
                    series: [67, 84, 97, 61],
                    plotOptions: {
                        radialBar: {
                            dataLabels: {
                                total: {
                                    show: true,
                                    label: 'TOTAL'
                                }
                            }
                        }
                    },
                    labels: ['TEAM A', 'TEAM B', 'TEAM C', 'TEAM D']
                };

                // var chart1 = new ApexCharts(document.querySelector("#chart1"), options1);

                // chart1.render();
            }
            // Getallscore()
            // Getallscore1()

            var Allscore
            // console.log("hello setting")
            showUserNameDetail()
            function showUserNameDetail() {
                var user = GetUser_id();
                document.getElementById('inputUsername').value = user.username;
                document.getElementById('inputHeight').value = user.Height;
                document.getElementById('inputWeight').value = user.Weight;
            }
            async function initInDashBoard() {

                init()
                changeDay()
                var AllHIIT
                var User = GetUser()
                Allscore = await getScoreById(User._id)

                AllHIIT = Allscore.filter((s) => { return s.NameEx == "hiit" })

                AllHIIT.forEach(h => {
                    if (h.Score == 1) {
                        h.Score = "Easy"
                    } else if (h.Score == 2) {
                        h.Score = "Intermediate"
                    } else if (h.Score == 3) {
                        h.Score = "Advance"
                    } if (h.Status) {
                        h.Status = "<span class='badge bg-success text-muted' style='color:white !important' >Complete</span>"
                    } else if (!h.Status) {
                        h.Status = "<span class='badge bg-danger text-muted' style='color:white !important'>Incomplete</span>"
                    }
                    var newDate = new Date(h.DateTime)
                    var newFormatDate = `${newDate.getDate()}/${newDate.getMonth() + 1}/${newDate.getFullYear()}`

                    if (h.Seconds == 0) {
                        h.Seconds = "--:--"
                    } else {
                        h.Seconds = timeset(h.Seconds)
                    }

                    // document.getElementById('HiiT').innerHTML += `<tr><td> ${h.Score}</td> <td> ${newFormatDate} </td> <td> ${h.Seconds} </td><td> ${h.Status} </td><td> 200 </td></tr>`

                    console.log(h)
                });


                AllEndurnace = Allscore.filter((s) => { return s.NameEx == "endurance" })

                AllEndurnace.forEach(h => {
                    if (h.Score == 1) {
                        h.Score = "Easy"
                    } else if (h.Score == 2) {
                        h.Score = "Intermediate"
                    } else if (h.Score == 3) {
                        h.Score = "Advance"
                    } if (h.Status) {
                        h.Status = "<span class='badge bg-success text-muted' style='color:white !important' >Complete</span>"
                    } else if (!h.Status) {
                        h.Status = "<span class='badge bg-danger text-muted' style='color:white !important'>Incomplete</span>"
                    }
                    var newDate = new Date(h.DateTime)
                    var newFormatDate = `${newDate.getDate()}/${newDate.getMonth() + 1}/${newDate.getFullYear()}`

                    if (h.Seconds == 0) {
                        h.Seconds = "--:--"
                    } else {
                        h.Seconds = timeset(h.Seconds)
                    }

                    // document.getElementById('Endurance').innerHTML += `<tr><td> ${h.Score}</td> <td> ${newFormatDate} </td> <td> ${h.Seconds} </td><td> ${h.Status} </td><td> 200 </td></tr>`

                    console.log(h)
                });


            }
            function timeset(time) {
                var fontNum = 0
                var backNum = 0
                while (time > 0) {
                    if (time >= 60) {
                        time = time - 60
                        fontNum++
                    } else {
                        backNum = time
                        time = 0
                    }
                }
                console.log(`${setTwodigit(fontNum)}:${setTwodigit(backNum)}`)
                console.log(`fontNum`)
                return `${setTwodigit(fontNum)}:${setTwodigit(backNum)}`
            }
            function setTwodigit(num) {
                var returnNum = "0";
                if (num < 10) {
                    if (num == 9) {
                        return "09"
                    } if (num == 8) {
                        return "08"
                    } if (num == 7) {
                        return "07"
                    } if (num == 6) {
                        return "06"
                    } if (num == 5) {
                        return "05"
                    } if (num == 4) {
                        return "04"
                    } if (num == 3) {
                        return "03"
                    } if (num == 2) {
                        return "02"
                    } if (num == 1) {
                        return "01"
                    } if (num == 0) {
                        return "00"
                    }
                } else {
                    return num
                }
            }

            async function changeDay() {

                var change = document.getElementById("changeDay").value

                var User = GetUser()
                var Allscore = await getScoreById(User._id)

                // Allscore.filter((s) => {
                //     var onlyDate = s.createdAt.substring(0, 10);
                //     var Today = new Date().toISOString().substring(0, 10);
                //     if (onlyDate == Today) {
                //         return s
                //     }
                // })
                // console.log("Allscore")
                // console.log(Allscore)
                // console.log(":")
                var forshow;
                var now = moment()
                if (change == "0") {
                    now.set('hour', 0);
                    now.set('minute', 0);
                    now.set('second', 0);
                } else if (change == "1") {
                    now.subtract(7, 'day')
                } else if (change == "2") {
                    now.subtract(1, 'month')
                }
                document.getElementById('HiiT').innerHTML = "";
                forshow = Allscore.filter((s) => {
                    var showMode
                    var showTime
                    var showStatus
                    var tomoment = moment(s.DateTime)
                    var Fullround
                    if (s.NameEx == "hiit" && tomoment > now) {
                        var newDate = new Date(s.DateTime)
                        var newFormatDate = `${newDate.getDate()}/${newDate.getMonth() + 1}/${newDate.getFullYear()}`
                        if (s.Score == 1) {
                            showMode = "Easy"
                            Fullround = 8 * 5
                        } else if (s.Score == 2) {
                            showMode = "Intermediate"
                            Fullround = 12 * 5
                        } else if (s.Score == 3) {
                            showMode = "Advance"
                            Fullround = 15 * 5
                        } if (s.Status) {
                            showStatus = "<span class='badge bg-success text-muted' style='color:white !important' >Complete</span>"
                        } else if (!s.Status) {
                            showStatus = "<span class='badge bg-danger text-muted addMore'  style='color:white !important' title='Incomplete : Timeout'>Incomplete</span>"
                        }

                        if (s.Seconds == 0) {
                            showTime = "--:--"
                        } else {
                            showTime = timeset(s.Seconds)
                        }
                        var percent = 1;
                        if (!s.Status) {
                            var Allrep = GetRepByTime(s.createdAt, Allscore)
                            console.log("Allrep")
                            console.log(Allrep)
                            var allscore = 0;
                            Allrep.forEach((f) => {
                                allscore += parseInt(f.Score)
                            })
                            percent = allscore / Fullround
                            console.log("%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% " + percent)
                        }
                        var TotalCal = calcal(s.Seconds, s.Score);

                        document.getElementById('HiiT').innerHTML += `<tr><td> ${showMode}</td> <td> ${newFormatDate} </td> <td> ${showTime} </td><td> ${showStatus} </td><td> ${(parseFloat(percent) * parseFloat(TotalCal)).toFixed(2)} </td></tr>`
                        return s
                    }
                })
                document.getElementById('Endurance').innerHTML = "";
                forshow = Allscore.filter((s) => {
                    var showMode
                    var showTime
                    var showStatus
                    var tomoment = moment(s.DateTime)
                    var Fullround
                    if (s.NameEx == "endurance" && tomoment > now) {
                        var newDate = new Date(s.DateTime)
                        var newFormatDate = `${newDate.getDate()}/${newDate.getMonth() + 1}/${newDate.getFullYear()}`
                        if (s.Score == 1) {
                            showMode = "Easy"
                            Fullround = 8 * 5
                        } else if (s.Score == 2) {
                            showMode = "Intermediate"
                            Fullround = 12 * 5
                        } else if (s.Score == 3) {
                            showMode = "Advance"
                            Fullround = 15 * 5
                        } if (s.Status) {
                            showStatus = "<span class='badge bg-success text-muted' style='color:white !important' >Complete</span>"
                        } else if (!s.Status) {
                            showStatus = "<span class='badge bg-danger text-muted addMore'  style='color:white !important' title='Incomplete : Timeout'>Incomplete</span>"
                        }
                        if (s.Seconds == 0) {
                            showTime = "--:--"
                        } else {
                            showTime = timeset(s.Seconds)
                        }
                        var percent = 1;
                        if (!s.Status) {
                            var Allrep = GetRepByTime(s.createdAt, Allscore)
                            console.log("Allrep")
                            console.log(Allrep)
                            var allscore = 0;
                            Allrep.forEach((f) => {
                                allscore += parseInt(f.Score)
                            })
                            percent = allscore / Fullround
                            console.log("%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% " + percent)
                        }
                        var TotalCal = calcal(s.Seconds, s.Score);
                        document.getElementById('Endurance').innerHTML += `<tr><td> ${showMode}</td> <td> ${newFormatDate} </td> <td> ${showTime} </td><td> ${showStatus} </td><td> ${(parseFloat(percent) * parseFloat(TotalCal)).toFixed(2)} </td></tr>`
                        return s
                    }

                })
                forshow = Allscore.filter((s) => {
                    var showMode
                    var showTime
                    var tomoment = moment(s.DateTime)
                    if (tomoment > now) {
                        return s
                    }

                })
                Getallscore(forshow)
                Getallscore1()
                console.log(forshow)
                // console.log(document.getElementById("changeDay").value)
            }

            function calcal(second, Mode) {

                var user = GetUser()

                var kilocal
                var bmr
                var letcal
                var lbm

                if (user.gender.toLocaleLowerCase() == "male") {
                    letcal = 31
                    lbm = 0.32810 * (user.Weight) + (0.33929 * (user.Height)) - 29.5336


                } else if (user.gender.toLocaleLowerCase() == "female") {
                    letcal = 27
                    lbm = 0.29569 * (user.Weight) + (0.42813 * (user.Height)) - 43.2933
                }
                bmr = 370 + (21.6 * lbm)

                kilocal = bmr / 24

                var min = second * 0.0166666667
                var calmode

                if (Mode == 1) {
                    calmode = 0.5
                } else if (Mode == 2) {
                    calmode = 0.7
                } else if (Mode == 3) {
                    calmode = 1
                }
                var result = (kilocal * min) * calmode

                // var Inresult = result + Inresult

                return result.toFixed(2);

            }
            function GetRepByTime(time, Allscore) {
                var a = moment(time)
                var b = moment(time)
                var c = moment(time)
                var user = GetUser()
                var forReturn
                b.subtract(15, "second")
                c.add(15, "second")

                forReturn = Allscore.filter((s) => {
                    var stime = moment(s.createdAt)

                    if (b < stime && stime < c && s.NameEx.toLowerCase() != "hiit") {
                        return s
                    }
                })
                return forReturn
            }
        </script>
</body>

</html>