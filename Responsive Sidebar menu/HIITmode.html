<!DOCTYPE html>
<!-- Created by CodingLab |www.youtube.com/c/CodingLabYT-->
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <title> Human Pose Estimation Technology </title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Boxicons CDN Link -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.1/lib/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.1/lib/addons/p5.sound.min.js"></script>
    <script src="https://unpkg.com/ml5@0.4.2/dist/ml5.min.js"></script>
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>\
    <script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils_3d/control_utils_3d.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body onload="setScore() ">
    <div class="sidebar">
        <div class="logo-details">
            <i class='#'></i>
            <div class="logo_name">Human Pose</div>
            <i class='bx bx-menu' id="btn"></i>
        </div>
        <ul class="nav-list" style="margin-left: -30px;">
            <li>
                <i class='bx bx-search'></i>
                <input type="text" placeholder="Search...">
                <span class="tooltip">Search</span>
            </li>
            <li>
                <a href="index.html">
                    <i class='bx bx-grid-alt'></i>
                    <span class="links_name">Dashboard</span>
                </a>
                <span class="tooltip">Dashboard</span>
            </li>
            <li>
                <a href="Set-mode.html">
                    <i class='bx bx-transfer alt'></i>
                    <span class="links_name">Set mode</span>
                </a>
                <span class="tooltip">Exercise</span>
            </li>
            <li>
                <a href="HIITmode.html">
                    <i class='bx bx-task'></i>
                    <span class="links_name">HIIT Mode</span>
                </a>
                <span class="tooltip">HIIT Workout</span>
            </li>
            <li>
                <a href="Endurance Mode.html">
                    <i class='bx bx-task'></i>
                    <span class="links_name">Endurance Mode</span>
                </a>
                <span class="tooltip">Endurance Mode</span>
            </li>
            <!-- <li>
       <a href="user.html">
         <i class='bx bx-user' ></i>
         <span class="links_name">User</span>
       </a>
       <span class="tooltip">User</span>
     </li> -->
            <li>
                <a href="Video.html">
                    <i class='bx bx-video'></i>
                    <span class="links_name">Video</span>
                </a>
                <span class="tooltip">Video</span>
            </li>
            <li>
                <a href="Video-Stretching.html">
                    <i class='bx bx-video'></i>
                    <span class="links_name">Video-Stretching</span>
                </a>
                <span class="tooltip">Video-Stretching</span>
            </li>
            <li>
                <a href="History.html">
                    <i class='bx bx-pie-chart-alt-2'></i>
                    <span class="links_name">History</span>
                </a>
                <span class="tooltip">History</span>
            </li>
            <li>
                <a href="setting.html">
                    <i class='bx bx-cog'></i>
                    <span class="links_name">Setting</span>
                </a>
                <span class="tooltip">Setting</span>
            </li>
            <li class="profile">
                <div class="profile-details">
                    <!-- <img src="profile.jpg" alt="profileImg"> -->
                    <div class="name_job">
                        <div id="ShowUserName" class="name">User</div>
                        <div class="job">Web Human Pose</div>
                    </div>
                </div>
                <button><i class='bx bx-log-out' title="Log out!" onclick="logout()" id="log_out"></i></button>
            </li>
        </ul>
    </div>
    <section class="home-section" onload="setScore()">
        <!-- <div class="text">Set mode</div> -->
        <!-- <button type="button" class="btn btn-secondary btn-lg" href="#">HIIT Mode</button> -->
        <!-- <button type="button" class="btn btn-secondary btn-lg" href="#">Endurance Mode</button> -->

        <div class="Time , Counter">
            <h1 style="text-align: center; display: none;"> Counter : <span id="showCounter">0 </span></h1>
            <div class="center glassbox">
                <button class="ButtinEasy btnspace" id="btn-Easy" onclick="Setmode('Easy')"> Easy </button>
                <button class="ButtinIntermediate btnspace" id="btn-Intermediate"
                    onclick="Setmode('Intermediate')">Intermediate</button>
                <button class="ButtinAdvance btnspace" id="btn-Advance" onclick="Setmode('Advance')"> Advance </button>
                <button style="margin-top: 35px;" class="ButtinStart btn-hidden" id="TimeBTN" onclick="startTime()">
                    Start Training </button>
            </div>
            <div>
                <button style="display: flex;" id="plusScore" onclick="PlusCurrentScore()"> plusScore </button>
                <button class="btn-hidden" onclick="getUserScore()"> getScore </button>
            </div>

            <div class="Current , Exercise ">
                <div style="width: 100%;" class="grid">
                    <div class="g-col-6">
                        <div style="margin-left: 46%;" class="g-col-6">
                            <h2 style="margin-right: 100px; display: none;"> Next Exercise : <span id="NextEx"> </span>
                            </h2>
                        </div>
                    </div>
                    <div>
                        <main>
                            <video class="input_video glass center">
                            </video>
                            <div><canvas class="output_canvas" style="display: none;" width="1280px"
                                    height="720px"></canvas>
                            </div>
                            <div class="landmark-grid-container" style="display: none;"></div>
                        </main>
                    </div>
                    <div class="glassboxStatus center">
                        <h1 data-text="Repititions" class=" textcolor textRep">Repititions : <span id="CurrentScore">
                                0</span></h1>
                        <h1 class=" textcolor textTime"> Timer : <span id="showTime">0 </span></h1>
                        <h1 class=" textcolor1 textExercies"> <span id="CurrentEx">
                            </span></h1>
                    </div>
    </section>

    <script>
        var timesquats = 0;
        var timepullup = 0;
        var timepushup = 0;
        var timeLegraise = 0;
        var timedmpushup = 0;
        // --------------------------

        var currentScore = 0;
        var timeleft = 0;
        var isStart = false;
        var timeCountdown
        var currentExerise = 1
        var iscomplete = false
        function startTime() {
            Swal.fire({
                position: ' ',
                icon: 'success',
                title: 'เริ่มออกกำลังกาย',
                text: 'ข้อควร : กรุณาให้กล้องเห็นทั้งร่างกาย!',
                showConfirmButton: false,
                timer: 2000
            })
            if (isStart == false) {
                iscomplete = false
                isStart = true;
                timeCountdown = setInterval(countdown, 1000)
                document.getElementById("TimeBTN").innerHTML = "Exit Training"
                timeleft = 0
                disabledLi(false)
            } else {
                Swal.fire({
                    title: 'ออกจากการออกกำลังกาย ?',
                    text: 'ระบบจะไม่ทำการบันทึกลงฐานข้อมูล',
                    showCancelButton: 'ยกเลิก',
                    confirmButtonText: 'Accept',
                    icon: "error"
                }).then((result) => {
                    /* Read more about isConfirmed, isDenied below */
                    if (result.isConfirmed) {
                        disabledLi(true)
                        isStart = false;
                        document.getElementById("TimeBTN").innerHTML = "Start Training"
                        clearTimeout(timeCountdown);
                        // isStart = false;
                        // document.getElementById("TimeBTN").innerHTML = "Start"
                        clearTimeout(timeCountdown);
                        // clearTimeout(timeCountdown2);
                        document.getElementById('showTime').innerHTML = '00:00'
                    }
                })
            }
        }

        function countdown() {
            var Mode = localStorage.getItem("Mode")
            var setTime = 0;
            console.log(timeleft)
            if (Mode == "Easy") {
                setTime = 10 * 60
            } if (Mode == "Intermediate") {
                setTime = 20 * 60
            } if (Mode == "Advance") {
                setTime = 30 * 60
            }
            if (timeleft >= setTime) {
                clearTimeout(timeCountdown);
                isStart = false;
                document.getElementById("showTime").innerHTML = 0;
                document.getElementById("TimeBTN").innerHTML = "Start"
                timeleft = 0
                Incomplete();
            } else {
                document.getElementById("showTime").innerHTML = timeset(setTime - timeleft);
                timeleft++;
                // console.log(timeleft)
            }
        }
        function timeset(time) {
            var fontNum = 0
            var backNum = 0
            while (time > 0) {
                if (time >= 60) {
                    time = time - 60
                    fontNum++
                } else {
                    backNum = time
                    time = 0
                }

            }

            console.log(`${setTwodigit(fontNum)}:${setTwodigit(backNum)}`)
            console.log(`fontNum`)
            return `${setTwodigit(fontNum)}:${setTwodigit(backNum)}`
        }
        function setTwodigit(num) {
            var returnNum = "0";
            if (num < 10) {
                if (num == 9) {
                    return "09"
                } if (num == 8) {
                    return "08"
                } if (num == 7) {
                    return "07"
                } if (num == 6) {
                    return "06"
                } if (num == 5) {
                    return "05"
                } if (num == 4) {
                    return "04"
                } if (num == 3) {
                    return "03"
                } if (num == 2) {
                    return "02"
                } if (num == 1) {
                    return "01"
                } if (num == 0) {
                    return "00"
                }
            } else {
                return num
            }
        }
        function Setmode(Mode) {
            var title = " "
            var html = " "
            if (Mode == "Easy") {
                localStorage.setItem("Mode", "Easy")
                // console.log("Easy")
                Mode = "Easy"
                // console.log(Mode)
                title = "ระดับ Beginner"
                html = `ต้องผ่านภายใน 10 นาที ทุกท่าทาง 8 ครั้ง / 1 เซต <br>
                Squats , Pull-UP , Push-UP , Leg Raise , DMPush-UP`
            }
            if (Mode == "Intermediate") {
                localStorage.setItem("Mode", "Intermediate")
                console.log("Intermediate")
                title = "ระดับ Intermediate"
                html = `ต้องผ่านภายใน 20 นาที ทุกท่าทาง 12 ครั้ง / 1 เซต <br>
                Squats , Pull-UP , Push-UP , Leg Raise , DMPush-UP`
            }
            if (Mode == "Advance") {
                localStorage.setItem("Mode", "Advance")
                console.log("Advance")
                Mode = "Advance"
                title = "ระดับ Advance"
                html = `ต้องผ่านภายใน 30 นาที ทุกท่าทาง 15 ครั้ง / 1 เซต <br>
                Squats , Pull-UP , Push-UP , Leg Raise , DMPush-UP`
            }
            Swal.fire({
                title: title,
                // text: `ต้องผ่านภายใน 10 นาที  ทุกท่าทาง 8 ครั้ง / 1 เซต`,
                html: html,
                icon: 'question',
                iconHtml: '?',
                confirmButtonText: 'ตกลง',
                // showCancelButton: true,
                showCloseButton: false
            }).then((result) => {
                camerastart();
                document.getElementById("TimeBTN").style.display = "block"
                SelectedMode(Mode)
            })
            timeleft = 0;

        }
        function SelectedMode(Mode) {
            if (Mode == "Easy") {
                document.getElementById("btn-Easy").style.display = "none"
                document.getElementById("btn-Intermediate").style.display = "none"
                document.getElementById("btn-Advance").style.display = "none"
            }
            if (Mode == "Intermediate") {
                document.getElementById("btn-Easy").style.display = "none"
                document.getElementById("btn-Intermediate").style.display = "none"
                document.getElementById("btn-Advance").style.display = "none"
            }
            if (Mode == "Advance") {
                document.getElementById("btn-Easy").style.display = "none"
                document.getElementById("btn-Intermediate").style.display = "none"
                document.getElementById("btn-Advance").style.display = "none"
            }
        }
        async function Incomplete() {
            disabledLi(true)
            Swal.fire({
                title: 'Incomplete Workout',
                text: 'Incomplete Workout Code:101 Timeout',
                width: 600,
                padding: '3em',
                color: '#716add',
                background: '#fff url(/images/trees.png)',
                backdrop: `
                    rgba(0,0,123,0.4)
                    url("/images/nyan-cat.gif")
                    left top
                    no-repeat
                `
            })
            if (currentExerise == 1) {
            }
            var User = GetUser()
            var ScoreModel = {
                UserId: User._id,
                NameEx: "",
                Seconds: null,
                Score: null,
                DateTime: new Date(),
                Status: false
            }
            var HIITModel = {
                UserId: User._id,
                NameEx: "HIIT",
                Score: null,
                Seconds: timeleft,
                DateTime: new Date(),
                Status: false
            }
            var Mode = localStorage.getItem("Mode")
            if (Mode == "Easy") {
                HIITModel.Score = 1
                ScoreModel.Score = 8
                HIITModel.Seconds = 10 * 60
            } if (Mode == "Intermediate") {
                HIITModel.Score = 2
                ScoreModel.Score = 12
                HIITModel.Seconds = 20 * 60
            } if (Mode == "Advance") {
                HIITModel.Score = 3
                ScoreModel.Score = 15
                HIITModel.Seconds = 30 * 60
            }
            if (currentExerise >= 1) {
                if (currentExerise == 1) {
                    ScoreModel.Score = currentScore
                }
                ScoreModel.NameEx = "Squats"
                ScoreModel.Seconds = timesquats
                await addLineInScoreDB(HIITModel)
                await addLineInScoreDB(ScoreModel)
            }
            if (currentExerise >= 2) {
                if (currentExerise == 2) {
                    ScoreModel.Score = currentScore
                }
                ScoreModel.NameEx = "Pull-Up"
                ScoreModel.Seconds = timepullup
                await addLineInScoreDB(ScoreModel)
            }
            if (currentExerise >= 3) {
                if (currentExerise == 3) {
                    ScoreModel.Score = currentScore
                }
                ScoreModel.NameEx = "Push-Up"
                ScoreModel.Seconds = timepushup
                await addLineInScoreDB(ScoreModel)
            }
            if (currentExerise >= 4) {
                if (currentExerise == 4) {
                    ScoreModel.Score = currentScore
                }
                ScoreModel.NameEx = "Legraise"
                ScoreModel.Seconds = timeLegraise
                await addLineInScoreDB(ScoreModel)
            } if (currentExerise >= 5) {
                if (currentExerise == 5) {
                    ScoreModel.Score = currentScore
                }
                ScoreModel.NameEx = "Dmpushup"
                ScoreModel.Seconds = timedmpushup
                await addLineInScoreDB(ScoreModel)
            }
        }
        async function complete() {
            disabledLi(true)
            Swal.fire(
                'เสร็จสิ้นการออกกำลังกาย',
                'คุณสามารถดูสถิติการออกกำลังได้ที่ DASHBOARD',
                'success'
            )
            var User = GetUser()
            var ScoreModel = {
                UserId: User._id,
                NameEx: "",
                Seconds: null,
                Score: null,
                DateTime: new Date(),
                Status: true
            }
            var HIITModel = {
                UserId: User._id,
                NameEx: "HIIT",
                Score: null,
                Seconds: timeleft,
                DateTime: new Date(),
                Status: true
            }
            var Mode = localStorage.getItem("Mode")
            if (Mode == "Easy") {
                HIITModel.Score = 1
                ScoreModel.Score = 8
            } if (Mode == "Intermediate") {
                HIITModel.Score = 2
                ScoreModel.Score = 12
            } if (Mode == "Advance") {
                HIITModel.Score = 3
                ScoreModel.Score = 15
            }
            await addLineInScoreDB(HIITModel)
            ScoreModel.NameEx = "Squats"
            ScoreModel.Seconds = timesquats
            await addLineInScoreDB(ScoreModel)
            ScoreModel.NameEx = "Pull-Up"
            ScoreModel.Seconds = timepullup
            await addLineInScoreDB(ScoreModel)
            ScoreModel.NameEx = "Push-Up"
            ScoreModel.Seconds = timepushup
            await addLineInScoreDB(ScoreModel)
            ScoreModel.NameEx = "Legraise"
            ScoreModel.Seconds = timeLegraise
            await addLineInScoreDB(ScoreModel)
            ScoreModel.NameEx = "Dmpushup"
            ScoreModel.Seconds = timedmpushup
            await addLineInScoreDB(ScoreModel)

        }
        async function getUserScore() {
            const UserApi = "http://localhost:3000/user/"
            var user = localStorage.getItem("User_Ex");
            var userObj = JSON.parse(user);
            var response = await fetch(UserApi + "getScore/" + userObj._id)
            var { data } = await response.json()
            var strToJson = JSON.parse(data.AllScore)
            console.log(strToJson)

            return strToJson;
        }

        function PlusCurrentScore() {
            currentScore++;
            document.getElementById("CurrentScore").innerHTML = currentScore
        }
    </script>
    <script>
        const videoElement = document.getElementsByClassName('input_video')[0];
        const canvasElement = document.getElementsByClassName('output_canvas')[0];
        const canvasCtx = canvasElement.getContext('2d');
        const landmarkContainer = document.getElementsByClassName('landmark-grid-container')[0];
        const grid = new LandmarkGrid(landmarkContainer);

        var stage = "down";
        function onResults(results) {
            if (!results.poseLandmarks) {
                grid.updateLandmarks([]);
                return;
            }

            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.segmentationMask, 0, 0,
                canvasElement.width, canvasElement.height);

            // Only overwrite existing pixels.
            canvasCtx.globalCompositeOperation = 'source-in';
            canvasCtx.fillStyle = '#00FF00';
            // canvasCtx.fillRect(0, 0, canvasElement.width, canvasElement.height);

            // Only overwrite missing pixels.
            canvasCtx.globalCompositeOperation = 'destination-atop';
            canvasCtx.drawImage(
                results.image, 0, 0, canvasElement.width, canvasElement.height);

            canvasCtx.globalCompositeOperation = 'source-over';
            drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS,
                { color: '#00FF00', lineWidth: 4 });
            drawLandmarks(canvasCtx, results.poseLandmarks,
                { color: '#FF0000', lineWidth: 2 });
            canvasCtx.restore();

            MainExcercise("test", results.poseLandmarks)
            grid.updateLandmarks(results.poseWorldLandmarks);
        }

        const pose = new Pose({
            locateFile: (file) => {
                return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
            }
        });
        pose.setOptions({
            modelComplexity: 1,
            smoothLandmarks: true,
            enableSegmentation: true,
            smoothSegmentation: true,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });
        pose.onResults(onResults);

        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await pose.send({ image: videoElement });
            },
            width: 1280,
            height: 720
        });

        function camerastart() {
            camera.start();
            currentExerise = 1

        }
        function MainExcercise(nameExercise, poseLandmarks) {

            var CurScore = document.getElementById('CurrentScore').innerHTML
            var mode = localStorage.getItem('Mode')
            var round = 0
            console.log(CurScore)
            if (mode == 'Easy') {
                round = 8
                // alert('Easy')
            }
            if (mode == 'Intermediate') {
                round = 12
                // alert('Intermediate')
            }
            if (mode == 'Advance') {
                round = 15
                // alert('Advance')
            }
            if (currentScore % round == 0 && currentScore > 1) {
                if (currentExerise == 1) {
                    timesquats = timeleft

                }
                else if (currentExerise == 2) {
                    timepullup = timeleft - timesquats


                } else if (currentExerise == 3) {
                    timepushup = timeleft - timesquats - timepullup


                } else if (currentExerise == 4) {
                    timeLegraise = timeleft - timesquats - timepullup - timepushup


                } else if (currentExerise == 5) {
                    timedmpushup = timeleft - timesquats - timepullup - timepushup - timeLegraise

                }
                currentExerise++
                currentScore = 0
                document.getElementById('CurrentScore').innerHTML = currentScore

            }

            // timesquats
            if (currentExerise == 1) {
                nameExercise = "1"
            } else if (currentExerise == 2) {
                nameExercise = "2";
            } else if (currentExerise == 3) {
                nameExercise = "3";
            } else if (currentExerise == 4) {
                nameExercise = "4";
            } else if (currentExerise == 5) {
                nameExercise = "5";
            }
            else if (currentExerise == 6 && iscomplete == false) {
                complete()
                iscomplete = true
                ChangeEx("complete", "complete")
                isStart = false;
                clearTimeout(timeCountdown);
                document.getElementById("TimeBTN").innerHTML = "Start Training"
                currentExerise = 1
            }

            switch (nameExercise) {
                case "1": {
                    getPoseSquats(poseLandmarks)
                    ChangeEx("Squats", "Pull-UP")

                    break;
                }
                case "2": {
                    getPosePullup(poseLandmarks)
                    ChangeEx("Pull UP", "Push UP")
                    break;
                }
                case "3": {
                    getPosePushup(poseLandmarks)
                    ChangeEx("Push UP", "Leg Raise")
                    break;
                }
                case "4": {
                    getPoseLegraise(poseLandmarks)
                    ChangeEx("Leg Raise", "DMPush-UP")
                    break;
                }
                case "5": {
                    getPoseDMPushup(poseLandmarks)
                    ChangeEx("DMPush-UP", "--:--")
                    break;
                }
            }
        }
        // ============================================================================== Squats =================================================================================== // 
        // ท่า Squats 
        function getPoseSquats(poseLandmarks) {
            var hipRight = poseLandmarks[24];
            var kneeRight = poseLandmarks[26];
            var AnkleRight = poseLandmarks[28];
            var angle = Squats_calculate_angle(hipRight, kneeRight, AnkleRight);

            countScoreSquats(angle, poseLandmarks);
        }
        // ตรวจสอบคำนวณท่า Squats , ดูองศาร่างกาย
        async function countScoreSquats(angle, poseLandmarks) {
            if (CheckSpot(poseLandmarks)) {
                if (angle > 160) {
                    stage = "down"
                }
                if (angle < 75 && stage == "down") {
                    var counter = document.getElementById("showCounter").innerHTML;
                    var currentex = document.getElementById("CurrentEx").innerHTML;
                    document.getElementById("CurrentEx").innerHTML = "Squats";
                    console.log("counter : " + counter);
                    counter++;
                    stage = "up";
                    // success

                    // change score
                    document.getElementById("showCounter").innerHTML = counter;
                    await plusScore("Squats");
                    PlusCurrentScore()
                    console.log(poseLandmarks)
                }
            }
        }
        // คำนวณท่าทาง Squats และ คำนวณเพื่อจะ Counter
        function Squats_calculate_angle(hip, knee, ankle) {
            var a = [hip.x, hip.y];
            var b = [knee.x, knee.y];
            var c = [ankle.x, ankle.y];

            var radians = Math.atan2(c[1] - b[1], c[0] - b[0]) - Math.atan2(a[1] - b[1], a[0] - b[0]);
            var angle = Math.abs(radians * 180.0 / Math.PI)

            if (angle > 180.0) {
                angle = 360 - angle
            }
            return angle;
        }
        // ============================================================================== Pull-UP =================================================================================== // 
        // ตรวจจับท่า Pull-Up
        function getPosePullup(poseLandmarks) {
            var wristRight = poseLandmarks[16];
            var elbowRight = poseLandmarks[14];
            var shoulderRight = poseLandmarks[12];
            var angle = Pullup_calculate_angle(wristRight, elbowRight, shoulderRight);

            countScorePullup(angle, poseLandmarks);
        }
        // ตรวจสอบคำนวณท่า Pull-Up
        async function countScorePullup(angle, poseLandmarks) {
            if (CheckSpot(poseLandmarks)) {
                if (angle > 160) {
                    stage = "down"
                }
                if (angle < 50 && stage == "down") {
                    document.getElementById("CurrentEx").innerHTML = "Pull up";
                    var counter = document.getElementById("showCounter").innerHTML;
                    console.log("counter : " + counter);
                    counter++;
                    stage = "up";
                    // success
                    // change score
                    document.getElementById("showCounter").innerHTML = counter;
                    await plusScore("Pullup");
                    PlusCurrentScore()
                    console.log(poseLandmarks)
                }
            }
        }
        // คำนวณท่าทาง PullUP และ คำนวณเพื่อจะ Counter
        function Pullup_calculate_angle(wristRight, elbowRight, shoulderRight) {
            var a = [wristRight.x, wristRight.y];
            var b = [elbowRight.x, elbowRight.y];
            var c = [shoulderRight.x, shoulderRight.y];

            var radians = Math.atan2(c[1] - b[1], c[0] - b[0]) - Math.atan2(a[1] - b[1], a[0] - b[0]);
            var angle = Math.abs(radians * 180.0 / Math.PI)

            if (angle > 180.0) {
                angle = 360 - angle
            }
            return angle;
        }

        // ============================================================================== Pushup =================================================================================== // 
        // ท่า Pushup 
        function getPosePushup(poseLandmarks) {
            var shoulderRight = poseLandmarks[12];
            var elbowRight = poseLandmarks[14];
            var wristRight = poseLandmarks[16];

            var angle = Pushup_calculate_angle(shoulderRight, elbowRight, wristRight);

            countScorePushup(angle, poseLandmarks);
        }
        // ตรวจสอบท่าคำนวณ Pushup 
        async function countScorePushup(angle, poseLandmarks) {
            if (angle > 160) {
                stage = "down"
            }
            if (angle < 100 && stage == "down") {
                var counter = document.getElementById("showCounter").innerHTML;
                var currentex = document.getElementById("CurrentEx").innerHTML;
                document.getElementById("CurrentEx").innerHTML = "Push-UP";
                console.log("counter : " + counter);
                counter++;
                stage = "up";
                // success

                // change score
                document.getElementById("showCounter").innerHTML = counter;
                await plusScore("push-up")
                PlusCurrentScore()
                console.log(poseLandmarks)
            }
        }
        function Pushup_calculate_angle(shoulder, elbow, wrist) {
            var a = [shoulder.x, shoulder.y];
            var b = [elbow.x, elbow.y];
            var c = [wrist.x, wrist.y];

            var radians = Math.atan2(c[1] - b[1], c[0] - b[0]) - Math.atan2(a[1] - b[1], a[0] - b[0]);
            var angle = Math.abs(radians * 180.0 / Math.PI)

            if (angle > 180.0) {
                angle = 360 - angle
            }
            return angle;
        }
        // ============================================================================== Legraise =================================================================================== // 
        // ท่า Legraise
        function getPoseLegraise(poseLandmarks) {
            var AnkleRight = poseLandmarks[28];
            var kneeRight = poseLandmarks[26];
            var hipRight = poseLandmarks[24];
            var angle = Legraise_calculate_angle(AnkleRight, kneeRight, hipRight);

            countScoreLegraise(angle, poseLandmarks);
        }
        // ตรวจสอบท่าคำนวณ Pushup 
        async function countScoreLegraise(angle, poseLandmarks) {
            if (CheckSpot(poseLandmarks)) {
                if (angle > 170) {
                    stage = "down"
                }
                if (angle < 160 && stage == "down") {
                    var counter = document.getElementById("showCounter").innerHTML;
                    var currentex = document.getElementById("CurrentEx").innerHTML;
                    document.getElementById("CurrentEx").innerHTML = "legraise";
                    console.log("counter : " + counter);
                    counter++;
                    stage = "up";
                    // success

                    // change score
                    document.getElementById("showCounter").innerHTML = counter;
                    await plusScore("legraise")
                    PlusCurrentScore()
                    console.log(poseLandmarks)
                }
            }
        }
        function Legraise_calculate_angle(AnkleRight, kneeRight, hipRight) {
            var a = [AnkleRight.x, AnkleRight.y];
            var b = [kneeRight.x, kneeRight.y];
            var c = [hipRight.x, hipRight.y];

            var radians = Math.atan2(c[1] - b[1], c[0] - b[0]) - Math.atan2(a[1] - b[1], a[0] - b[0]);
            var angle = Math.abs(radians * 180.0 / Math.PI)

            if (angle > 180.0) {
                angle = 360 - angle
            }
            return angle;
        }

        // ============================================================================== DMPushUP =================================================================================== // 
        // ท่า Legraise
        function getPoseDMPushup(poseLandmarks) {
            var shoulderRight = poseLandmarks[12];
            var elbowRight = poseLandmarks[14];
            var wristRight = poseLandmarks[16];

            var angle = DMPushup_calculate_angle(shoulderRight, elbowRight, wristRight);

            countScoreDMPushup(angle, poseLandmarks);
        }
        // ตรวจสอบท่าคำนวณ Pushup 
        async function countScoreDMPushup(angle, poseLandmarks) {
            if (angle > 160) {
                stage = "down"
            }
            if (angle < 100 && stage == "down") {
                var counter = document.getElementById("showCounter").innerHTML;
                var currentex = document.getElementById("CurrentEx").innerHTML;
                document.getElementById("CurrentEx").innerHTML = "Push-UP";
                console.log("counter : " + counter);
                counter++;
                stage = "up";
                // success

                // change score
                document.getElementById("showCounter").innerHTML = counter;
                await plusScore("dmpushup")
                PlusCurrentScore()
                console.log(poseLandmarks)
            }
        }
        function Pushup_calculate_angle(shoulder, elbow, wrist) {
            var a = [shoulder.x, shoulder.y];
            var b = [elbow.x, elbow.y];
            var c = [wrist.x, wrist.y];

            var radians = Math.atan2(c[1] - b[1], c[0] - b[0]) - Math.atan2(a[1] - b[1], a[0] - b[0]);
            var angle = Math.abs(radians * 180.0 / Math.PI)

            if (angle > 180.0) {
                angle = 360 - angle
            }
            return angle;
        }
        // ตรวจสอบเท้าของ User ให้คำนวณไม่ผิดพลาด
        function CheckSpot(poseLandmarks) {
            var footLeft = poseLandmarks[31];
            var footRight = poseLandmarks[32];
            var isCorrect = false;
            var correctPercent = 0.68;
            if (footLeft.visibility > correctPercent && footRight.visibility > correctPercent) {
                isCorrect = true;
            }
            return isCorrect;
        }

        function ChangeEx(currentEx, nextEx) {
            document.getElementById("CurrentEx").innerHTML = currentEx;
            document.getElementById("NextEx").innerHTML = nextEx;
        }

    </script>
    <script src="ScoreApi.js"></script>
    <script src="script.js"></script>
</body>

</html>